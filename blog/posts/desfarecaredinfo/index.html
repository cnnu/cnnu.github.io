<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>MF3 IC D40 中文手册 | CHALNONE</title>
<meta name=keywords content="标签"><meta name=description content="Desc Text."><meta name=author content="CHALNONE"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/blog/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=http://cnnu.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://cnnu.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://cnnu.github.io/favicon-32x32.png><link rel=apple-touch-icon href=http://cnnu.github.io/apple-touch-icon.png><link rel=mask-icon href=http://cnnu.github.io/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://cnnu.github.io/blog/posts/desfarecaredinfo/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="MF3 IC D40 中文手册"><meta property="og:description" content="Desc Text."><meta property="og:type" content="article"><meta property="og:url" content="http://cnnu.github.io/blog/posts/desfarecaredinfo/"><meta property="og:image" content="http://cnnu.github.io/blog/%3Cimage%20path/url%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-02-10T14:12:47+08:00"><meta property="article:modified_time" content="2025-02-10T14:12:47+08:00"><meta property="og:site_name" content="Chalnone 's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://cnnu.github.io/blog/%3Cimage%20path/url%3E"><meta name=twitter:title content="MF3 IC D40 中文手册"><meta name=twitter:description content="Desc Text."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://cnnu.github.io/blog/posts/"},{"@type":"ListItem","position":2,"name":"MF3 IC D40 中文手册","item":"http://cnnu.github.io/blog/posts/desfarecaredinfo/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"MF3 IC D40 中文手册","name":"MF3 IC D40 中文手册","description":"Desc Text.","keywords":["标签"],"articleBody":"MF3 IC D40 中文手册 1 特性 1.1 RF 接口：ISO 14443 类型 A 通过 RF 场实现数据非接触式传输和供电（无需电池） 操作距离：最大 100mm（取决于天线的形状） 操作频率：13.56MHz 快速数据传输：106kbit/s，424kbit/s 高数据完整性：4 字节 MAC、16 位 CRC、奇偶校验、位编码、位计数 真实可确定的防冲突性 7 字节的唯一标识符（符合 ISO 14443-3 的级联第二层） 使用 ISO 14443-4 传输协议 1.2 非易失性（NV）存储器 4k 字节 NV-存储器 NV-存储器写时间 2ms（1ms 擦除，1ms 编程） 数据可保存 10 年 可写 100,000 次 1.3 NV-存储器组织 灵活的文件系统 一个 PICC 最多可同时存在 28 个应用 每个应用程序多达 16 个文件 1.4 安全性 每个器件有唯一的 7 字节序列号 交互的 3 段验证 RF 信道的硬件 DES/3DES 数据加密，可防止重放攻击 通过 4 字节 MAC 进行数据验证 应用级验证 2 概述 PHILIPS 开发了 MIFARE DESFire (MF3 IC D40) 可用于符合 ISO 14443 类型 A 的近耦合设备（PCD）。传输协议遵循 ISO 14443-4 部分。MF3 IC D40 主要是为安全的非接触式传输应用和相关的 loyalty 程序而设计的。\n2.1 非接触式能量和数据传输 在 MIFARE 系统中，MF3 IC D40 与一个嵌入在标准 ISO 智能卡中的线圈相连接。不需要电池。当卡接近 PCD 天线时，高速通信接口可实现高达 424kbit/s 的数据传输。\n2.2 交付类型 8\" 圆晶上的管芯，在 FFC 上切割，厚度 150um 8\" 圆晶上带金凸点的管芯，在 FFC 上切割，厚度 150um MOA2 非接触式芯片卡模块 2.3 防冲突 智能的防冲突机制允许同时处理多个 PICC。防冲突算法单独选择每个 PICC 并确保与选择的 PICC 正确执行处理，不会因为场中的其它 PICC 而导致数据被破坏。\n2.4 UID/序列号 唯一的 7 字节序列号（UID）编程到厂商保留的一个 NV 存储器锁定部分。由于安全性和系统的要求，这些字节在生产线编程之后处于写保护状态。\n2.5 存储器组织 4k 字节 NV 存储器通过灵活的文件系统来组织。文件系统允许单个 PICC 上存在最多 28 个不同的应用。每个应用最多提供 16 个文件。每个应用由它的 3 字节应用标识符（AID）表示。\n支持 5 种不同的文件类型，见 3.1。\n每个文件可在 PICC 初始化时（卡的生产/印刷）或 PICC 终端（自动售货机）或场中创建。\n如果文件或应用程序操作被废弃，可使它永久无效。\n对文件结构本身产生影响的命令（例如，建立或删除一个应用，改变密钥）会启动一个自动的恢复（rollback）机制，它可保护文件结构不会被破坏。\n2.6 安全性 7 字节 UID 在生产线编程之后就不能再进行更改，这样就确保了每个器件的唯一性。\nUID 可用于为每个卡生成多种密钥。多种 PICC 密钥可用于实现有效的防冲突机制。\n在数据发送之前，PICC 和 PCD 之间可完成 3 路验证，这取决于配置使用 DES 还是 3DES。\nPICC 和 PCD 之间的数据传输可在 3 层安全性下完成：\n直接的数据传输 带 DES/3DES 加密校验和（MAC）的直接数据传输 DES/3DES 加密的数据传输（在加密之前进行 CRC 校验） 应用层允许对用户数据进行访问。每个应用最多有 14 个不同的用户密钥用于控制对 PICC 中保存的数据进行访问。\n3 MF3 IC D40 – 安全编码、应用和文件相关特性 3.1 文件类型编码 应用中的文件可具有下列不同的类型：\n标准数据文件 （编码为 0x00） 备份数据文件 （编码为 0x01） 带备份的值文件 （编码为 0x02） 带备份的线性记录文件 （编码为 0x03） 带备份的循环记录文件 （编码为 0x04） 3.2 通信设定的编码－加密等级 通信设定定义了 PCD 与 PICC 之间通信的安全等级。通信设定总是适用于文件级。\n设定编码为 1 个字节，可设定为：\n通信模式 bit7-bit2 bit1 bit0 明码通信 RFU=0 忽略 0 DES/3DES MAC 所确保的明码通信 RFU=0 0 1 完全 DES/3DES 加密的通信 RFU=0 1 1 DES 和 3DES 密钥都保存在 16 个字节的字符串中；\n如果密钥串的后半部分等于前半部分，密钥作为单个 DES 密钥进行处理。\n如果密钥串的后半部分不等于前半部分，密钥作为 1 个 3DES 密钥进行处理。\n所有基于密钥的操作（验证，MACing，加密）分别使用 DES 或 3DES 方法进行进一步处理。\n单个 DES 密钥的例子： 0x00 11 22 33 44 55 66 77 00 11 22 33 44 55 66 77\n0x00 00 00 00 00 00 00 00 00 00 00 00 00 00 *\n3DES 密钥的例子： 0x00 11 22 33 44 55 66 77 88 99 AA BB CC DD EE FF\n0x00 11 22 33 44 55 66 77 00 00 00 00 00 00 01 00\n0x00 00 00 00 00 00 00 00 00 00 00 00 00 00\n所有 0x00 字节都是 MF3 IC D40 的默认密钥，而单个 DES 操作定义为默认操作。 3.3 访问权限编码 应用中的每个文件都有 4 种不同的访问权限（每个文件 2 字节）：\n读访问 写访问 读\u0026写访问 改变访问权限 每种访问权限都编码为 4 位，半字节。每个半字节代表与对应的应用密钥文件中的一个密钥的连接。\n半字节可实现 16 个不同值的编码。如果设定为 0~13 之间的数(最多 14 个密钥)，它对应于应用的密钥文件中一个特定的密钥，前提是该密钥存在（不允许配置一个不存在的密钥）。\n如果编码为 14（0xE），则表示“自由的”访问。在选择应用之后，不管之前是否进行验证，都允许进行相关的访问。\n如果只有“读”和“读\u0026写”访问（或“写”和“读\u0026写”访问）密钥中的一个设定为 0xE，其它密钥的值都不同于 0xE，在有效验证的情况下通信以 MAC/加密的方式执行，在没有有效验证的情况下通信以明码的方式执行。在第二种情况下，通信的设定被 PICC 所忽略。\n如果编码为 15（0xF），表示访问永远被禁止。因此各个连接的访问权总是被拒绝。\n必须知道两字节参数代码的最高 4 位以获取读访问权（可使用 GetValue 和 Debit 命令）。接下来的 4 位用于获取写访问权（可使用 GetValue, Debit 和 LimitedCredit 命令）。低字节的高半部分用于获取读\u0026写访问权。在值文件中，该权限允许完全访问（可使用 GetValue, Debit, LimitedCredit 和 Credit 命令）\n最低 4 位保存密钥的参考号码，当改变文件的时间权限和将每个访问权限连接到密钥号时，需要对它进行验证。\n访问权限的编码如下所示：\n15 12 11 8 7 4 3 0 读访问 写访问 读\u0026写访问 改变配置 MS Bit LS Bit\n读访问和读\u0026写访问权限允许执行读操作。\n写访问和读\u0026写访问权限允许执行写操作。\n如果访问一个文件时没有有效的验证，但至少可通过一个相关的访问权限实现自由访问（0xE），那么通信模式被强制为明码通信。\n3.4 状态编码和错误代码 Hex 代码 状态 描述 0x00 OPERATION_OK 成功的操作 0x0C NO_CHANGES 备份文件不改变，不需要 CommitTransaction 和 AbortTransaction 0x0E OUT_OF_EEPROM_ERROR 完成命令所需的 NV 存储器不足 0x1C ILLEGAL_COMMAND_CODE 不支持的命令代码 0x1E INTEGRITY_ERROR CRC 或 MAC 与数据不匹配，填充字节无效 0x40 NO_SUCH_KEY 指定的密钥无效 0x7E LENGTH_ERROR 命令串长度无效 0x9D PERMISSION_DENIED 当前的配置/状态拒绝执行所请求的命令 0x9E PARAMETER_ERROR 参数值无效 0xA0 APPLICATION_NOT_FOUND 请求的 AID 不存在 0xA1 APPL_INTEGRITY_ERROR 应用中不可恢复的错误，应用将被禁止* 0xAE AUTHENTICATION_ERROR 当前验证状态不允许执行请求的命令 0xAF ADDITIONAL_FRAME 期待发送额外的数据帧 0xBE BOUNDARY_ERROR 试图读取写入的数据超出文件/记录的边界。 0xC1 PICC_INTEGRITY_ERROR PICC 内不可恢复的错误，PICC 将被禁止* 0xCD PICC_DISABLED_ERROR PICC 因为一个不可恢复的错误而被禁止* 0xCE COUNT_ERROR 应用的数目限制为 28，CreateApplication 不再可用 0xDE DUPLICATE_ERROR 因为已经存在相同编号的文件/应用，因此文件/应用的创建失败。 0xEE EEPROM_ERROR 因为电源故障而无法完成 NV 写操作，启动内部备份/恢复机制。 0xF0 FILE_NOT_FOUND 指定的文件名不存在。 0xF1 FILE_INTEGRITY_ERROR 文件中不可恢复的错误，文件将被禁止* 这些错误在正常操作中是不期望出现的。 4 DESFIRE 命令集 4.1 命令集 ISO 14443-3： MF3 IC D40 提供下列符合 ISO 14443-3 的命令：\n4.1.1 请求类型 A (REQA) 代码 参数 数据 完整性机制 响应 0x26（7位） — — — 0x0344 描述：MF3 IC D40 只在空闲状态下接受 REQA 命令。响应为 2 字节 ATQA(0x0344)。REQA 和 ATQA 的实现完全符合 ISO 14443-3。\n4.1.2 唤醒 (WUPA) 代码 参数 数据 完整性机制 响应 0x52（7位） — — — 0x0344 描述：MF3 IC D40 只在空闲和暂停状态下接受 WUPA 命令。响应为 2 字节 ATQA(0x0344)。唤醒的实现完全符合 ISO 14443-3。\n4.1.3 级联第一级的防冲突和选择 代码 参数 数据 完整性机制 响应 防冲突：0x93 选择：0x93 0x20-0x67 0x70 部分 UID 级联标签，UID 的前 3 个字节 奇偶校验 奇偶校验，BCC, CRC 部分 UID SAK(0x24) 描述：防冲突命令和选择命令基于相同的命令代码。它们唯一的区别在于参数字节。该字节在选择时定义为 0x70。MF3 IC D40 只在 Ready1 状态接受这两个命令。响应是 UID 的第 1 部分。\n4.1.4 级联第 2 级的防冲突和选择 代码 参数 数据 完整性机制 响应 防冲突：0x95 选择：0x95 0x20-0x67 0x70 部分 UID 级联标签，UID 的后 4 个字节 奇偶校验 奇偶校验，BCC, CRC 部分 UID SAK(0x20) 描述：防冲突命令和选择命令基于相同的命令代码。它们唯一的区别在于参数字节。该字节在选择时定义为 0x70。MF3 IC D40 只在 Ready2 状态接受这两个命令。响应是 UID 的第 2 部分。\n4.2 命令集 ISO 14443-4： MF3 IC D40 提供下列符合 ISO 14443-4 的命令集：\n4.2.1 请求应答以选择（RATS） 代码 参数 数据 完整性机制 响应 0xE0 高半字节：FSDI 低半字节：CID — CRC 16 字节数据 描述：RATS 命令的响应提供 PICC 的类型使 PCD 进行识别。参数字节使用两个不同的参数编码进行通信：\nFSDI：参数字节的高半字节编码为 PCD 与 PICC 通信所支持的最大帧规格。 CID：参数字节的低半字节编码为被寻址的 PICC 的逻辑编号。该逻辑编号范围为 0x00~0x0E。 该 CID 用于区分单个 PCD 同时选择的几个 PICC。DESFire PICC 完全支持 CID，它使用 TC(1) 进行编码。\n4.2.2 协议和参数选择请求（PPS） 代码 参数 数据 完整性机制 响应 ‘Pposs’: DX PPS0 PPS1 — CRC Pposs: ‘D0’ 描述：PPS 命令允许独立选择 PCD 和 PICC 之间的通信波特率。对于 DESFire，可以在两个方向独立设置波特率。也就是说，DESFire 允许非对称的数据交换速度。\nPPSS：PPSS 的高半字节为 RFU（保留将来之用），因此设置为’D’。低半字节指示所选择的 PICC 的 CID，范围为 0x00~0x0E。 PPS0：PPS 参数 0 字节指示 PPS1 的存在并因此设置为 0x11。 PPS1：PPS 参数 1 字节定义 PCD 和 PICC 之间定时的分频系数，它直接定义每个方向的波特率。 PPS1 的高半字节为 RFU，必须设置为 0。bit b3 和 b2 编码 PICC 到 PCD 方向的分频系数，称为 DSI，bit b1 和 b0 编码 PCD 到 PICC 方向的分频系数，称为 DRI。\nDRI 和 DSI 的编码定义如下：\nDRI, DSI 位编码 00 01 10 分频系数 1 2 4 波特率 106k 212k 424k DESFire 支持双向高达 424kbaud 的波特率。请注意两个方向可以分别设置通信速度，例如，允许 PCD 到 PICC 方向使用 106kbaud(DRI=00)进行通信，而 PICC 到 PCD 使用 424kbaud 进行通信（DSI=10）。\n如果双向都使用 106kbaud 进行通信，PPS1 应当设置为 00。如果 PICC 没有接收到 PPS 命令，这将是它的默认值。\n4.2.3 帧等待延长（WTX） 如果 PICC 需要比定义的 FWT 更长的时间来响应 PCD 的命令，它会发送一个等待时间延长的请求。PICC 发送一个 14443-4 S-块。根据 ISO，INF 场包含 0x01，请求另一个 FWT 间隔。\nPCD 必须通过发送另一个 INF 场为 0x01 的 S-块来确认该请求。\n4.3 MF3 IC D40 命令集—安全性相关的命令 MF3 IC D40 提供下列用于安全性相关功能的命令集：\n4.3.1 Authenticate 在这个过程当中，PICC 和读卡器都以加密的方式显示它们拥有相同的密钥。该过程不仅确认两个允许互相操作的实体，而且还创建一个会话密钥用于保持进一步的安全通信。正如“会话密钥”这个名字所明确表明的，每次一个新的验证过程成功结束后，会获得一个新的密钥用于下一步加密的操作。\n4.3.2 ChangeKeySettings 该命令根据当前选择的 AID 改变主密钥的设定。\n如果之前已经选择 AID=0x00，则将更改应用到 PICC 密钥设定，否则（AID=0x0）应用到当前选择的应用的密钥设定。\n该命令只有在当前密钥设定中的“配置可更改”位置位的情况下才会成功执行。\n另外还需要在之前有一次成功的主密钥验证（如果 AID=0x00，则为 PICC 主密钥，否则为应用主密钥）。\n该命令带出一个字节的参数，它编码新的主密钥设定。\n为了保证 ChangeKeySettings 命令由执行之前验证命令的同一个 PCD 发送，因此应用的安全机制必须与 ChangeKey 命令所使用的安全机制相同，见 4.3.4。\n对参数字节进行 CRC 计算并附在参数字节之后。由于修改的数据流现在的长度为 3 个字节因此在后面加上 5 个值为 0x00 的字节，这样得到 8 字节长度的数据流，正好适合 DES/3DES 的译码操作。\n4.3.3 GetKeySettings GetKeySettings 命令可获取 PICC 和应用主密钥设定的信息。此外，它还返回所选应用中可保存的最大密钥数。\n该命令不传递参数。\n根据主密钥的设定（见 4.3.2），需要在该命令执行之前通过主密钥的验证。\n如果查询 PICC 主密钥的设定（当前选择的 AID=0x00），密钥数返回 0x01，因为 PICC 上只存在一个 PICC 主密钥。\n4.3.4 ChangeKey 该命令允许更改 PICC 上保存的任何密钥。\n如果选择 AID=0x00，则更改 PICC 主密钥，只有 KeyNo＝0x00 有效（PICC 上只存在一个 PICC 主密钥）。在所有其它情况下（AID≠0x00），更改应用于当前所选应用中的指定 KeyNo。\n4.3.5 GetKeyVersion GetKeyVersion 命令允许读出任何保存在 PICC 上的密钥的当前版本。\n如果选择 AID=0x0，该命令返回 PICC 主密钥的版本，并且只有 KeyNo=0x00 有效（PICC 上只存在一个 PICC 主密钥）。其它任何情况下（AID≠0x0），返回当前所选应用中指定的密钥的版本。\n4.4 MF3 IC D40 命令集—PICC 级命令： 4.4.1 CreateApplication CreateApplication 命令允许在 PICC 上建立新的应用。\n4.4.2 DeleteApplication DeleteApplication 命令允许使 PICC 上的应用永久失效。\n4.4.3 GetApplicationIDs GetApplicationIDs 命令返回 PICC 上所有有效应用的 AID。\n4.4.4 SelectApplication SelectApplication 命令用于选择一个指定的应用作进一步的访问。在正常操作中，这通常是一个随后的验证命令。\n4.4.5 FormatPICC 该命令释放 PICC 用户存储器。\n4.4.6 GetVersion GetVersion 命令返回 PICC 与制造有关的数据。\n4.5 MF3 IC D40 命令集—应用级命令： 4.5.1 GetFileIDs GetFileIDs 命令返回当前所选应用中所有有效文件的文件标识符。\n4.5.2 GetFileSettings GetFileSettings 命令可以从指定文件属性获得信息。该命令获取的信息取决于被查询文件的类型。\n4.5.3 ChangeFileSettings 该命令改变一个现有文件的访问参数。\n4.5.4 CreateStdDataFile CreateStdDataFile 命令在 PICC 现有的一个应用中创建用于保存无格式用户数据的文件。\n4.5.5 CreateBackupDataFile CreateBackupDataFile 命令在 PICC 现有的一个应用中创建用于保存无格式用户数据的文件，另外还支持集成的备份机制特性。\n4.5.6 CreateValueFile CreateValueFile 命令在 PICC 的一个现有文件中创建文件，该文件用于保存和处理 32 位有符号整数值。\n4.5.7 CreateLinearRecordFile CreateLinearRecordFile 命令在 PICC 的一个现有文件中创建文件，该文件用于结构相似的数据（例如 loyalty 程序）的多次存储。一旦该文件被数据记录填满，那么将无法再对该文件执行写操作，除非该文件被清空，见命令 ClearRecordFile 一节 4.6.9。\n4.5.8 CreateCyclicRecordFile CreateCyclicRecordFile 命令在 PICC 的一个现有文件中创建文件，该文件用于结构相似的数据（例如 loyalty 程序）的多次存储。一旦该文件被数据记录填满，PICC 自动将最新写入的记录覆盖最早的记录。该循环操作对 PCD 是完全透明的。\n4.5.9 DeleteFile DeleteFile 命令使当前所选应用的文件目录中的一个文件永远失效。\n4.6 MF3 IC D40 命令集—数据处理命令 4.6.1 ReadData ReadData 命令可从标准数据文件或备份数据文件中读出数据。\n4.6.2 WriteData WriteData 命令可以将数据写入标准数据文件或备份数据文件。\n4.6.3 GetValue GetValue 命令可以从文件中读出当前保存的值。\n4.6.4 Credit Credit 命令用于增加值文件中保存的值。\n4.6.5 Debit Dedit 命令用于减少值文件中保存的值。\n4.6.6 LimitedCredit LimitedCredit 命令在对文件没有完全的读\u0026写访问权限的情况下，可以使值文件中保存的值实现有限的增加。这一特性可以在文件创建时使能或禁止。\n4.6.7 WriteRecord WriteRecord 命令用于将数据写入一个循环或线性的记录文件。\n4.6.8 ReadRecords ReadRecords 可从一个循环或线性记录文件中读出一套完整的记录。\n4.6.9 ClearRecordFile ClearRecordFile 命令将一个循环或线性记录文件复位为清空的状态。\n4.6.10 CommitTransaction CommitTransaction 命令使应用中备份数据文件、值文件和记录文件的写操作生效。\n4.6.11 AbortTransaction AbortTransaction 命令使对应用中备份数据文件、值文件和记录文件的写操作无效。 Previous Next / [pdf] View the PDF file here. ","wordCount":"1113","inLanguage":"en","image":"http://cnnu.github.io/blog/%3Cimage%20path/url%3E","datePublished":"2025-02-10T14:12:47+08:00","dateModified":"2025-02-10T14:12:47+08:00","author":{"@type":"Person","name":"CHALNONE"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://cnnu.github.io/blog/posts/desfarecaredinfo/"},"publisher":{"@type":"Organization","name":"CHALNONE","logo":{"@type":"ImageObject","url":"http://cnnu.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://cnnu.github.io/blog/ accesskey=h title="  (Alt + H)"><img src=http://cnnu.github.io/logo.png alt aria-label=logo height=150></a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://cnnu.github.io title=主页><span>主页</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=http://cnnu.github.io/blog/archives title=归档><span>归档</span></a></li><li><a href=http://cnnu.github.io/blog/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=http://cnnu.github.io/blog/tags/ title=标签><span>标签</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://cnnu.github.io/blog/>Home</a>&nbsp;»&nbsp;<a href=http://cnnu.github.io/blog/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">MF3 IC D40 中文手册</h1><div class=post-description>Desc Text.</div><div class=post-meta><span title='2025-02-10 14:12:47 +0800 CST'>February 10, 2025</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;CHALNONE&nbsp;|&nbsp;<a href=https://github.com/cnnu/cnnu.github.io/content/posts/desfarecaredinfo.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#mf3-ic-d40-%e4%b8%ad%e6%96%87%e6%89%8b%e5%86%8c aria-label="MF3 IC D40 中文手册">MF3 IC D40 中文手册</a><ul><li><a href=#1-%e7%89%b9%e6%80%a7 aria-label="1 特性">1 特性</a><ul><li><a href=#11-rf-%e6%8e%a5%e5%8f%a3iso-14443-%e7%b1%bb%e5%9e%8b-a aria-label="1.1 RF 接口：ISO 14443 类型 A">1.1 RF 接口：ISO 14443 类型 A</a></li><li><a href=#12-%e9%9d%9e%e6%98%93%e5%a4%b1%e6%80%a7nv%e5%ad%98%e5%82%a8%e5%99%a8 aria-label="1.2 非易失性（NV）存储器">1.2 非易失性（NV）存储器</a></li><li><a href=#13-nv-%e5%ad%98%e5%82%a8%e5%99%a8%e7%bb%84%e7%bb%87 aria-label="1.3 NV-存储器组织">1.3 NV-存储器组织</a></li><li><a href=#14-%e5%ae%89%e5%85%a8%e6%80%a7 aria-label="1.4 安全性">1.4 安全性</a></li></ul></li><li><a href=#2-%e6%a6%82%e8%bf%b0 aria-label="2 概述">2 概述</a><ul><li><a href=#21-%e9%9d%9e%e6%8e%a5%e8%a7%a6%e5%bc%8f%e8%83%bd%e9%87%8f%e5%92%8c%e6%95%b0%e6%8d%ae%e4%bc%a0%e8%be%93 aria-label="2.1 非接触式能量和数据传输">2.1 非接触式能量和数据传输</a></li><li><a href=#22-%e4%ba%a4%e4%bb%98%e7%b1%bb%e5%9e%8b aria-label="2.2 交付类型">2.2 交付类型</a></li><li><a href=#23-%e9%98%b2%e5%86%b2%e7%aa%81 aria-label="2.3 防冲突">2.3 防冲突</a></li><li><a href=#24-uid%e5%ba%8f%e5%88%97%e5%8f%b7 aria-label="2.4 UID/序列号">2.4 UID/序列号</a></li><li><a href=#25-%e5%ad%98%e5%82%a8%e5%99%a8%e7%bb%84%e7%bb%87 aria-label="2.5 存储器组织">2.5 存储器组织</a></li><li><a href=#26-%e5%ae%89%e5%85%a8%e6%80%a7 aria-label="2.6 安全性">2.6 安全性</a></li></ul></li><li><a href=#3-mf3-ic-d40--%e5%ae%89%e5%85%a8%e7%bc%96%e7%a0%81%e5%ba%94%e7%94%a8%e5%92%8c%e6%96%87%e4%bb%b6%e7%9b%b8%e5%85%b3%e7%89%b9%e6%80%a7 aria-label="3 MF3 IC D40 – 安全编码、应用和文件相关特性">3 MF3 IC D40 – 安全编码、应用和文件相关特性</a><ul><li><a href=#31-%e6%96%87%e4%bb%b6%e7%b1%bb%e5%9e%8b%e7%bc%96%e7%a0%81 aria-label="3.1 文件类型编码">3.1 文件类型编码</a></li><li><a href=#32-%e9%80%9a%e4%bf%a1%e8%ae%be%e5%ae%9a%e7%9a%84%e7%bc%96%e7%a0%81%e5%8a%a0%e5%af%86%e7%ad%89%e7%ba%a7 aria-label="3.2 通信设定的编码－加密等级">3.2 通信设定的编码－加密等级</a></li><li><a href=#33-%e8%ae%bf%e9%97%ae%e6%9d%83%e9%99%90%e7%bc%96%e7%a0%81 aria-label="3.3 访问权限编码">3.3 访问权限编码</a></li><li><a href=#34-%e7%8a%b6%e6%80%81%e7%bc%96%e7%a0%81%e5%92%8c%e9%94%99%e8%af%af%e4%bb%a3%e7%a0%81 aria-label="3.4 状态编码和错误代码">3.4 状态编码和错误代码</a></li></ul></li><li><a href=#4-desfire-%e5%91%bd%e4%bb%a4%e9%9b%86 aria-label="4 DESFIRE 命令集">4 DESFIRE 命令集</a><ul><li><a href=#41-%e5%91%bd%e4%bb%a4%e9%9b%86-iso-14443-3 aria-label="4.1 命令集 ISO 14443-3：">4.1 命令集 ISO 14443-3：</a><ul><li><a href=#411-%e8%af%b7%e6%b1%82%e7%b1%bb%e5%9e%8b-a-reqa aria-label="4.1.1 请求类型 A (REQA)">4.1.1 请求类型 A (REQA)</a></li><li><a href=#412-%e5%94%a4%e9%86%92-wupa aria-label="4.1.2 唤醒 (WUPA)">4.1.2 唤醒 (WUPA)</a></li><li><a href=#413-%e7%ba%a7%e8%81%94%e7%ac%ac%e4%b8%80%e7%ba%a7%e7%9a%84%e9%98%b2%e5%86%b2%e7%aa%81%e5%92%8c%e9%80%89%e6%8b%a9 aria-label="4.1.3 级联第一级的防冲突和选择">4.1.3 级联第一级的防冲突和选择</a></li><li><a href=#414-%e7%ba%a7%e8%81%94%e7%ac%ac-2-%e7%ba%a7%e7%9a%84%e9%98%b2%e5%86%b2%e7%aa%81%e5%92%8c%e9%80%89%e6%8b%a9 aria-label="4.1.4 级联第 2 级的防冲突和选择">4.1.4 级联第 2 级的防冲突和选择</a></li></ul></li><li><a href=#42-%e5%91%bd%e4%bb%a4%e9%9b%86-iso-14443-4 aria-label="4.2 命令集 ISO 14443-4：">4.2 命令集 ISO 14443-4：</a><ul><li><a href=#421-%e8%af%b7%e6%b1%82%e5%ba%94%e7%ad%94%e4%bb%a5%e9%80%89%e6%8b%a9rats aria-label="4.2.1 请求应答以选择（RATS）">4.2.1 请求应答以选择（RATS）</a></li><li><a href=#422-%e5%8d%8f%e8%ae%ae%e5%92%8c%e5%8f%82%e6%95%b0%e9%80%89%e6%8b%a9%e8%af%b7%e6%b1%82pps aria-label="4.2.2 协议和参数选择请求（PPS）">4.2.2 协议和参数选择请求（PPS）</a></li><li><a href=#423-%e5%b8%a7%e7%ad%89%e5%be%85%e5%bb%b6%e9%95%bfwtx aria-label="4.2.3 帧等待延长（WTX）">4.2.3 帧等待延长（WTX）</a></li></ul></li><li><a href=#43-mf3-ic-d40-%e5%91%bd%e4%bb%a4%e9%9b%86%e5%ae%89%e5%85%a8%e6%80%a7%e7%9b%b8%e5%85%b3%e7%9a%84%e5%91%bd%e4%bb%a4 aria-label="4.3 MF3 IC D40 命令集—安全性相关的命令">4.3 MF3 IC D40 命令集—安全性相关的命令</a><ul><li><a href=#431-authenticate aria-label="4.3.1 Authenticate">4.3.1 Authenticate</a></li><li><a href=#432-changekeysettings aria-label="4.3.2 ChangeKeySettings">4.3.2 ChangeKeySettings</a></li><li><a href=#433-getkeysettings aria-label="4.3.3 GetKeySettings">4.3.3 GetKeySettings</a></li><li><a href=#434-changekey aria-label="4.3.4 ChangeKey">4.3.4 ChangeKey</a></li><li><a href=#435-getkeyversion aria-label="4.3.5 GetKeyVersion">4.3.5 GetKeyVersion</a></li></ul></li><li><a href=#44-mf3-ic-d40-%e5%91%bd%e4%bb%a4%e9%9b%86picc-%e7%ba%a7%e5%91%bd%e4%bb%a4 aria-label="4.4 MF3 IC D40 命令集—PICC 级命令：">4.4 MF3 IC D40 命令集—PICC 级命令：</a><ul><li><a href=#441-createapplication aria-label="4.4.1 CreateApplication">4.4.1 CreateApplication</a></li><li><a href=#442-deleteapplication aria-label="4.4.2 DeleteApplication">4.4.2 DeleteApplication</a></li><li><a href=#443-getapplicationids aria-label="4.4.3 GetApplicationIDs">4.4.3 GetApplicationIDs</a></li><li><a href=#444-selectapplication aria-label="4.4.4 SelectApplication">4.4.4 SelectApplication</a></li><li><a href=#445-formatpicc aria-label="4.4.5 FormatPICC">4.4.5 FormatPICC</a></li><li><a href=#446-getversion aria-label="4.4.6 GetVersion">4.4.6 GetVersion</a></li></ul></li><li><a href=#45-mf3-ic-d40-%e5%91%bd%e4%bb%a4%e9%9b%86%e5%ba%94%e7%94%a8%e7%ba%a7%e5%91%bd%e4%bb%a4 aria-label="4.5 MF3 IC D40 命令集—应用级命令：">4.5 MF3 IC D40 命令集—应用级命令：</a><ul><li><a href=#451-getfileids aria-label="4.5.1 GetFileIDs">4.5.1 GetFileIDs</a></li><li><a href=#452-getfilesettings aria-label="4.5.2 GetFileSettings">4.5.2 GetFileSettings</a></li><li><a href=#453-changefilesettings aria-label="4.5.3 ChangeFileSettings">4.5.3 ChangeFileSettings</a></li><li><a href=#454-createstddatafile aria-label="4.5.4 CreateStdDataFile">4.5.4 CreateStdDataFile</a></li><li><a href=#455-createbackupdatafile aria-label="4.5.5 CreateBackupDataFile">4.5.5 CreateBackupDataFile</a></li><li><a href=#456-createvaluefile aria-label="4.5.6 CreateValueFile">4.5.6 CreateValueFile</a></li><li><a href=#457-createlinearrecordfile aria-label="4.5.7 CreateLinearRecordFile">4.5.7 CreateLinearRecordFile</a></li><li><a href=#458-createcyclicrecordfile aria-label="4.5.8 CreateCyclicRecordFile">4.5.8 CreateCyclicRecordFile</a></li><li><a href=#459-deletefile aria-label="4.5.9 DeleteFile">4.5.9 DeleteFile</a></li></ul></li><li><a href=#46-mf3-ic-d40-%e5%91%bd%e4%bb%a4%e9%9b%86%e6%95%b0%e6%8d%ae%e5%a4%84%e7%90%86%e5%91%bd%e4%bb%a4 aria-label="4.6 MF3 IC D40 命令集—数据处理命令">4.6 MF3 IC D40 命令集—数据处理命令</a><ul><li><a href=#461-readdata aria-label="4.6.1 ReadData">4.6.1 ReadData</a></li><li><a href=#462-writedata aria-label="4.6.2 WriteData">4.6.2 WriteData</a></li><li><a href=#463-getvalue aria-label="4.6.3 GetValue">4.6.3 GetValue</a></li><li><a href=#464-credit aria-label="4.6.4 Credit">4.6.4 Credit</a></li><li><a href=#465-debit aria-label="4.6.5 Debit">4.6.5 Debit</a></li><li><a href=#466-limitedcredit aria-label="4.6.6 LimitedCredit">4.6.6 LimitedCredit</a></li><li><a href=#467-writerecord aria-label="4.6.7 WriteRecord">4.6.7 WriteRecord</a></li><li><a href=#468-readrecords aria-label="4.6.8 ReadRecords">4.6.8 ReadRecords</a></li><li><a href=#469-clearrecordfile aria-label="4.6.9 ClearRecordFile">4.6.9 ClearRecordFile</a></li><li><a href=#4610-committransaction aria-label="4.6.10 CommitTransaction">4.6.10 CommitTransaction</a></li><li><a href=#4611-aborttransaction aria-label="4.6.11 AbortTransaction">4.6.11 AbortTransaction</a></li></ul></li></ul></li></ul></li></ul></div></details></div><div class=post-content><h1 id=mf3-ic-d40-中文手册>MF3 IC D40 中文手册<a hidden class=anchor aria-hidden=true href=#mf3-ic-d40-中文手册>#</a></h1><h2 id=1-特性>1 特性<a hidden class=anchor aria-hidden=true href=#1-特性>#</a></h2><h3 id=11-rf-接口iso-14443-类型-a>1.1 RF 接口：ISO 14443 类型 A<a hidden class=anchor aria-hidden=true href=#11-rf-接口iso-14443-类型-a>#</a></h3><ul><li>通过 RF 场实现数据非接触式传输和供电（无需电池）</li><li>操作距离：最大 100mm（取决于天线的形状）</li><li>操作频率：13.56MHz</li><li>快速数据传输：106kbit/s，424kbit/s</li><li>高数据完整性：4 字节 MAC、16 位 CRC、奇偶校验、位编码、位计数</li><li>真实可确定的防冲突性</li><li>7 字节的唯一标识符（符合 ISO 14443-3 的级联第二层）</li><li>使用 ISO 14443-4 传输协议</li></ul><h3 id=12-非易失性nv存储器>1.2 非易失性（NV）存储器<a hidden class=anchor aria-hidden=true href=#12-非易失性nv存储器>#</a></h3><ul><li>4k 字节 NV-存储器</li><li>NV-存储器写时间 2ms（1ms 擦除，1ms 编程）</li><li>数据可保存 10 年</li><li>可写 100,000 次</li></ul><h3 id=13-nv-存储器组织>1.3 NV-存储器组织<a hidden class=anchor aria-hidden=true href=#13-nv-存储器组织>#</a></h3><ul><li>灵活的文件系统</li><li>一个 PICC 最多可同时存在 28 个应用</li><li>每个应用程序多达 16 个文件</li></ul><h3 id=14-安全性>1.4 安全性<a hidden class=anchor aria-hidden=true href=#14-安全性>#</a></h3><ul><li>每个器件有唯一的 7 字节序列号</li><li>交互的 3 段验证</li><li>RF 信道的硬件 DES/3DES 数据加密，可防止重放攻击</li><li>通过 4 字节 MAC 进行数据验证</li><li>应用级验证</li></ul><h2 id=2-概述>2 概述<a hidden class=anchor aria-hidden=true href=#2-概述>#</a></h2><p>PHILIPS 开发了 MIFARE DESFire (MF3 IC D40) 可用于符合 ISO 14443 类型 A 的近耦合设备（PCD）。传输协议遵循 ISO 14443-4 部分。MF3 IC D40 主要是为安全的非接触式传输应用和相关的 loyalty 程序而设计的。</p><h3 id=21-非接触式能量和数据传输>2.1 非接触式能量和数据传输<a hidden class=anchor aria-hidden=true href=#21-非接触式能量和数据传输>#</a></h3><p>在 MIFARE 系统中，MF3 IC D40 与一个嵌入在标准 ISO 智能卡中的线圈相连接。不需要电池。当卡接近 PCD 天线时，高速通信接口可实现高达 424kbit/s 的数据传输。</p><h3 id=22-交付类型>2.2 交付类型<a hidden class=anchor aria-hidden=true href=#22-交付类型>#</a></h3><ul><li>8" 圆晶上的管芯，在 FFC 上切割，厚度 150um</li><li>8" 圆晶上带金凸点的管芯，在 FFC 上切割，厚度 150um</li><li>MOA2 非接触式芯片卡模块</li></ul><h3 id=23-防冲突>2.3 防冲突<a hidden class=anchor aria-hidden=true href=#23-防冲突>#</a></h3><p>智能的防冲突机制允许同时处理多个 PICC。防冲突算法单独选择每个 PICC 并确保与选择的 PICC 正确执行处理，不会因为场中的其它 PICC 而导致数据被破坏。</p><h3 id=24-uid序列号>2.4 UID/序列号<a hidden class=anchor aria-hidden=true href=#24-uid序列号>#</a></h3><p>唯一的 7 字节序列号（UID）编程到厂商保留的一个 NV 存储器锁定部分。由于安全性和系统的要求，这些字节在生产线编程之后处于写保护状态。</p><h3 id=25-存储器组织>2.5 存储器组织<a hidden class=anchor aria-hidden=true href=#25-存储器组织>#</a></h3><p>4k 字节 NV 存储器通过灵活的文件系统来组织。文件系统允许单个 PICC 上存在最多 28 个不同的应用。每个应用最多提供 16 个文件。每个应用由它的 3 字节应用标识符（AID）表示。</p><p>支持 5 种不同的文件类型，见 3.1。</p><p>每个文件可在 PICC 初始化时（卡的生产/印刷）或 PICC 终端（自动售货机）或场中创建。</p><p>如果文件或应用程序操作被废弃，可使它永久无效。</p><p>对文件结构本身产生影响的命令（例如，建立或删除一个应用，改变密钥）会启动一个自动的恢复（rollback）机制，它可保护文件结构不会被破坏。</p><h3 id=26-安全性>2.6 安全性<a hidden class=anchor aria-hidden=true href=#26-安全性>#</a></h3><p>7 字节 UID 在生产线编程之后就不能再进行更改，这样就确保了每个器件的唯一性。</p><p>UID 可用于为每个卡生成多种密钥。多种 PICC 密钥可用于实现有效的防冲突机制。</p><p>在数据发送之前，PICC 和 PCD 之间可完成 3 路验证，这取决于配置使用 DES 还是 3DES。</p><p>PICC 和 PCD 之间的数据传输可在 3 层安全性下完成：</p><ul><li>直接的数据传输</li><li>带 DES/3DES 加密校验和（MAC）的直接数据传输</li><li>DES/3DES 加密的数据传输（在加密之前进行 CRC 校验）</li></ul><p>应用层允许对用户数据进行访问。每个应用最多有 14 个不同的用户密钥用于控制对 PICC 中保存的数据进行访问。</p><h2 id=3-mf3-ic-d40--安全编码应用和文件相关特性>3 MF3 IC D40 – 安全编码、应用和文件相关特性<a hidden class=anchor aria-hidden=true href=#3-mf3-ic-d40--安全编码应用和文件相关特性>#</a></h2><h3 id=31-文件类型编码>3.1 文件类型编码<a hidden class=anchor aria-hidden=true href=#31-文件类型编码>#</a></h3><p>应用中的文件可具有下列不同的类型：</p><ul><li>标准数据文件 （编码为 0x00）</li><li>备份数据文件 （编码为 0x01）</li><li>带备份的值文件 （编码为 0x02）</li><li>带备份的线性记录文件 （编码为 0x03）</li><li>带备份的循环记录文件 （编码为 0x04）</li></ul><h3 id=32-通信设定的编码加密等级>3.2 通信设定的编码－加密等级<a hidden class=anchor aria-hidden=true href=#32-通信设定的编码加密等级>#</a></h3><p>通信设定定义了 PCD 与 PICC 之间通信的安全等级。通信设定总是适用于文件级。</p><p>设定编码为 1 个字节，可设定为：</p><table><thead><tr><th>通信模式</th><th>bit7-bit2</th><th>bit1</th><th>bit0</th></tr></thead><tbody><tr><td>明码通信</td><td>RFU=0</td><td>忽略</td><td>0</td></tr><tr><td>DES/3DES MAC 所确保的明码通信</td><td>RFU=0</td><td>0</td><td>1</td></tr><tr><td>完全 DES/3DES 加密的通信</td><td>RFU=0</td><td>1</td><td>1</td></tr></tbody></table><p>DES 和 3DES 密钥都保存在 16 个字节的字符串中；</p><p>如果密钥串的后半部分等于前半部分，密钥作为单个 DES 密钥进行处理。</p><p>如果密钥串的后半部分不等于前半部分，密钥作为 1 个 3DES 密钥进行处理。</p><p>所有基于密钥的操作（验证，MACing，加密）分别使用 DES 或 3DES 方法进行进一步处理。</p><p>单个 DES 密钥的例子： 0x00 11 22 33 44 55 66 77 00 11 22 33 44 55 66 77</p><p>0x00 00 00 00 00 00 00 00 00 00 00 00 00 00 *</p><p>3DES 密钥的例子： 0x00 11 22 33 44 55 66 77 88 99 AA BB CC DD EE FF</p><p>0x00 11 22 33 44 55 66 77 00 00 00 00 00 00 01 00</p><p>0x00 00 00 00 00 00 00 00 00 00 00 00 00 00</p><ul><li>所有 0x00 字节都是 MF3 IC D40 的默认密钥，而单个 DES 操作定义为默认操作。</li></ul><h3 id=33-访问权限编码>3.3 访问权限编码<a hidden class=anchor aria-hidden=true href=#33-访问权限编码>#</a></h3><p>应用中的每个文件都有 4 种不同的访问权限（每个文件 2 字节）：</p><ul><li>读访问</li><li>写访问</li><li>读&写访问</li><li>改变访问权限</li></ul><p>每种访问权限都编码为 4 位，半字节。每个半字节代表与对应的应用密钥文件中的一个密钥的连接。</p><p>半字节可实现 16 个不同值的编码。如果设定为 0~13 之间的数(最多 14 个密钥)，它对应于应用的密钥文件中一个特定的密钥，前提是该密钥存在（不允许配置一个不存在的密钥）。</p><p>如果编码为 14（0xE），则表示“自由的”访问。在选择应用之后，不管之前是否进行验证，都允许进行相关的访问。</p><p>如果只有“读”和“读&写”访问（或“写”和“读&写”访问）密钥中的一个设定为 0xE，其它密钥的值都不同于 0xE，在有效验证的情况下通信以 MAC/加密的方式执行，在没有有效验证的情况下通信以明码的方式执行。在第二种情况下，通信的设定被 PICC 所忽略。</p><p>如果编码为 15（0xF），表示访问永远被禁止。因此各个连接的访问权总是被拒绝。</p><p>必须知道两字节参数代码的最高 4 位以获取读访问权（可使用 GetValue 和 Debit 命令）。接下来的 4 位用于获取写访问权（可使用 GetValue, Debit 和 LimitedCredit 命令）。低字节的高半部分用于获取读&写访问权。在值文件中，该权限允许完全访问（可使用 GetValue, Debit, LimitedCredit 和 Credit 命令）</p><p>最低 4 位保存密钥的参考号码，当改变文件的时间权限和将每个访问权限连接到密钥号时，需要对它进行验证。</p><p>访问权限的编码如下所示：</p><table><thead><tr><th>15 12</th><th>11</th><th>8 7</th><th>4 3</th><th>0</th></tr></thead><tbody><tr><td>读访问</td><td>写访问</td><td>读&写访问</td><td>改变配置</td><td></td></tr></tbody></table><p>MS Bit LS Bit</p><p>读访问和读&写访问权限允许执行读操作。</p><p>写访问和读&写访问权限允许执行写操作。</p><p>如果访问一个文件时没有有效的验证，但至少可通过一个相关的访问权限实现自由访问（0xE），那么通信模式被强制为明码通信。</p><h3 id=34-状态编码和错误代码>3.4 状态编码和错误代码<a hidden class=anchor aria-hidden=true href=#34-状态编码和错误代码>#</a></h3><table><thead><tr><th>Hex 代码</th><th>状态</th><th>描述</th></tr></thead><tbody><tr><td>0x00</td><td>OPERATION_OK</td><td>成功的操作</td></tr><tr><td>0x0C</td><td>NO_CHANGES</td><td>备份文件不改变，不需要 CommitTransaction 和 AbortTransaction</td></tr><tr><td>0x0E</td><td>OUT_OF_EEPROM_ERROR</td><td>完成命令所需的 NV 存储器不足</td></tr><tr><td>0x1C</td><td>ILLEGAL_COMMAND_CODE</td><td>不支持的命令代码</td></tr><tr><td>0x1E</td><td>INTEGRITY_ERROR</td><td>CRC 或 MAC 与数据不匹配，填充字节无效</td></tr><tr><td>0x40</td><td>NO_SUCH_KEY</td><td>指定的密钥无效</td></tr><tr><td>0x7E</td><td>LENGTH_ERROR</td><td>命令串长度无效</td></tr><tr><td>0x9D</td><td>PERMISSION_DENIED</td><td>当前的配置/状态拒绝执行所请求的命令</td></tr><tr><td>0x9E</td><td>PARAMETER_ERROR</td><td>参数值无效</td></tr><tr><td>0xA0</td><td>APPLICATION_NOT_FOUND</td><td>请求的 AID 不存在</td></tr><tr><td>0xA1</td><td>APPL_INTEGRITY_ERROR</td><td>应用中不可恢复的错误，应用将被禁止*</td></tr><tr><td>0xAE</td><td>AUTHENTICATION_ERROR</td><td>当前验证状态不允许执行请求的命令</td></tr><tr><td>0xAF</td><td>ADDITIONAL_FRAME</td><td>期待发送额外的数据帧</td></tr><tr><td>0xBE</td><td>BOUNDARY_ERROR</td><td>试图读取写入的数据超出文件/记录的边界。</td></tr><tr><td>0xC1</td><td>PICC_INTEGRITY_ERROR</td><td>PICC 内不可恢复的错误，PICC 将被禁止*</td></tr><tr><td>0xCD</td><td>PICC_DISABLED_ERROR</td><td>PICC 因为一个不可恢复的错误而被禁止*</td></tr><tr><td>0xCE</td><td>COUNT_ERROR</td><td>应用的数目限制为 28，CreateApplication 不再可用</td></tr><tr><td>0xDE</td><td>DUPLICATE_ERROR</td><td>因为已经存在相同编号的文件/应用，因此文件/应用的创建失败。</td></tr><tr><td>0xEE</td><td>EEPROM_ERROR</td><td>因为电源故障而无法完成 NV 写操作，启动内部备份/恢复机制。</td></tr><tr><td>0xF0</td><td>FILE_NOT_FOUND</td><td>指定的文件名不存在。</td></tr><tr><td>0xF1</td><td>FILE_INTEGRITY_ERROR</td><td>文件中不可恢复的错误，文件将被禁止*</td></tr></tbody></table><ul><li>这些错误在正常操作中是不期望出现的。</li></ul><h2 id=4-desfire-命令集>4 DESFIRE 命令集<a hidden class=anchor aria-hidden=true href=#4-desfire-命令集>#</a></h2><h3 id=41-命令集-iso-14443-3>4.1 命令集 ISO 14443-3：<a hidden class=anchor aria-hidden=true href=#41-命令集-iso-14443-3>#</a></h3><p>MF3 IC D40 提供下列符合 ISO 14443-3 的命令：</p><h4 id=411-请求类型-a-reqa>4.1.1 请求类型 A (REQA)<a hidden class=anchor aria-hidden=true href=#411-请求类型-a-reqa>#</a></h4><table><thead><tr><th>代码</th><th>参数</th><th>数据</th><th>完整性机制</th><th>响应</th></tr></thead><tbody><tr><td>0x26（7位）</td><td>—</td><td>—</td><td>—</td><td>0x0344</td></tr></tbody></table><p>描述：MF3 IC D40 只在空闲状态下接受 REQA 命令。响应为 2 字节 ATQA(0x0344)。REQA 和 ATQA 的实现完全符合 ISO 14443-3。</p><h4 id=412-唤醒-wupa>4.1.2 唤醒 (WUPA)<a hidden class=anchor aria-hidden=true href=#412-唤醒-wupa>#</a></h4><table><thead><tr><th>代码</th><th>参数</th><th>数据</th><th>完整性机制</th><th>响应</th></tr></thead><tbody><tr><td>0x52（7位）</td><td>—</td><td>—</td><td>—</td><td>0x0344</td></tr></tbody></table><p>描述：MF3 IC D40 只在空闲和暂停状态下接受 WUPA 命令。响应为 2 字节 ATQA(0x0344)。唤醒的实现完全符合 ISO 14443-3。</p><h4 id=413-级联第一级的防冲突和选择>4.1.3 级联第一级的防冲突和选择<a hidden class=anchor aria-hidden=true href=#413-级联第一级的防冲突和选择>#</a></h4><table><thead><tr><th>代码</th><th>参数</th><th>数据</th><th>完整性机制</th><th>响应</th></tr></thead><tbody><tr><td>防冲突：0x93 选择：0x93</td><td>0x20-0x67 0x70</td><td>部分 UID 级联标签，UID 的前 3 个字节</td><td>奇偶校验 奇偶校验，BCC, CRC</td><td>部分 UID SAK(0x24)</td></tr></tbody></table><p>描述：防冲突命令和选择命令基于相同的命令代码。它们唯一的区别在于参数字节。该字节在选择时定义为 0x70。MF3 IC D40 只在 Ready1 状态接受这两个命令。响应是 UID 的第 1 部分。</p><h4 id=414-级联第-2-级的防冲突和选择>4.1.4 级联第 2 级的防冲突和选择<a hidden class=anchor aria-hidden=true href=#414-级联第-2-级的防冲突和选择>#</a></h4><table><thead><tr><th>代码</th><th>参数</th><th>数据</th><th>完整性机制</th><th>响应</th></tr></thead><tbody><tr><td>防冲突：0x95 选择：0x95</td><td>0x20-0x67 0x70</td><td>部分 UID 级联标签，UID 的后 4 个字节</td><td>奇偶校验 奇偶校验，BCC, CRC</td><td>部分 UID SAK(0x20)</td></tr></tbody></table><p>描述：防冲突命令和选择命令基于相同的命令代码。它们唯一的区别在于参数字节。该字节在选择时定义为 0x70。MF3 IC D40 只在 Ready2 状态接受这两个命令。响应是 UID 的第 2 部分。</p><h3 id=42-命令集-iso-14443-4>4.2 命令集 ISO 14443-4：<a hidden class=anchor aria-hidden=true href=#42-命令集-iso-14443-4>#</a></h3><p>MF3 IC D40 提供下列符合 ISO 14443-4 的命令集：</p><h4 id=421-请求应答以选择rats>4.2.1 请求应答以选择（RATS）<a hidden class=anchor aria-hidden=true href=#421-请求应答以选择rats>#</a></h4><table><thead><tr><th>代码</th><th>参数</th><th>数据</th><th>完整性机制</th><th>响应</th></tr></thead><tbody><tr><td>0xE0</td><td>高半字节：FSDI 低半字节：CID</td><td>—</td><td>CRC</td><td>16 字节数据</td></tr></tbody></table><p>描述：RATS 命令的响应提供 PICC 的类型使 PCD 进行识别。参数字节使用两个不同的参数编码进行通信：</p><ul><li>FSDI：参数字节的高半字节编码为 PCD 与 PICC 通信所支持的最大帧规格。</li><li>CID：参数字节的低半字节编码为被寻址的 PICC 的逻辑编号。该逻辑编号范围为 0x00~0x0E。</li></ul><p>该 CID 用于区分单个 PCD 同时选择的几个 PICC。DESFire PICC 完全支持 CID，它使用 TC(1) 进行编码。</p><h4 id=422-协议和参数选择请求pps>4.2.2 协议和参数选择请求（PPS）<a hidden class=anchor aria-hidden=true href=#422-协议和参数选择请求pps>#</a></h4><table><thead><tr><th>代码</th><th>参数</th><th>数据</th><th>完整性机制</th><th>响应</th></tr></thead><tbody><tr><td>‘Pposs’: DX</td><td>PPS0 PPS1</td><td>—</td><td>CRC</td><td>Pposs: ‘D0’</td></tr></tbody></table><p>描述：PPS 命令允许独立选择 PCD 和 PICC 之间的通信波特率。对于 DESFire，可以在两个方向独立设置波特率。也就是说，DESFire 允许非对称的数据交换速度。</p><ul><li>PPSS：PPSS 的高半字节为 RFU（保留将来之用），因此设置为’D’。低半字节指示所选择的 PICC 的 CID，范围为 0x00~0x0E。</li><li>PPS0：PPS 参数 0 字节指示 PPS1 的存在并因此设置为 0x11。</li><li>PPS1：PPS 参数 1 字节定义 PCD 和 PICC 之间定时的分频系数，它直接定义每个方向的波特率。</li></ul><p>PPS1 的高半字节为 RFU，必须设置为 0。bit b3 和 b2 编码 PICC 到 PCD 方向的分频系数，称为 DSI，bit b1 和 b0 编码 PCD 到 PICC 方向的分频系数，称为 DRI。</p><p>DRI 和 DSI 的编码定义如下：</p><table><thead><tr><th>DRI, DSI 位编码</th><th>00</th><th>01</th><th>10</th></tr></thead><tbody><tr><td>分频系数</td><td>1</td><td>2</td><td>4</td></tr><tr><td>波特率</td><td>106k</td><td>212k</td><td>424k</td></tr></tbody></table><p>DESFire 支持双向高达 424kbaud 的波特率。请注意两个方向可以分别设置通信速度，例如，允许 PCD 到 PICC 方向使用 106kbaud(DRI=00)进行通信，而 PICC 到 PCD 使用 424kbaud 进行通信（DSI=10）。</p><p>如果双向都使用 106kbaud 进行通信，PPS1 应当设置为 00。如果 PICC 没有接收到 PPS 命令，这将是它的默认值。</p><h4 id=423-帧等待延长wtx>4.2.3 帧等待延长（WTX）<a hidden class=anchor aria-hidden=true href=#423-帧等待延长wtx>#</a></h4><p>如果 PICC 需要比定义的 FWT 更长的时间来响应 PCD 的命令，它会发送一个等待时间延长的请求。PICC 发送一个 14443-4 S-块。根据 ISO，INF 场包含 0x01，请求另一个 FWT 间隔。</p><p>PCD 必须通过发送另一个 INF 场为 0x01 的 S-块来确认该请求。</p><h3 id=43-mf3-ic-d40-命令集安全性相关的命令>4.3 MF3 IC D40 命令集—安全性相关的命令<a hidden class=anchor aria-hidden=true href=#43-mf3-ic-d40-命令集安全性相关的命令>#</a></h3><p>MF3 IC D40 提供下列用于安全性相关功能的命令集：</p><h4 id=431-authenticate>4.3.1 Authenticate<a hidden class=anchor aria-hidden=true href=#431-authenticate>#</a></h4><p>在这个过程当中，PICC 和读卡器都以加密的方式显示它们拥有相同的密钥。该过程不仅确认两个允许互相操作的实体，而且还创建一个会话密钥用于保持进一步的安全通信。正如“会话密钥”这个名字所明确表明的，每次一个新的验证过程成功结束后，会获得一个新的密钥用于下一步加密的操作。</p><h4 id=432-changekeysettings>4.3.2 ChangeKeySettings<a hidden class=anchor aria-hidden=true href=#432-changekeysettings>#</a></h4><p>该命令根据当前选择的 AID 改变主密钥的设定。</p><p>如果之前已经选择 AID=0x00，则将更改应用到 PICC 密钥设定，否则（AID=0x0）应用到当前选择的应用的密钥设定。</p><p>该命令只有在当前密钥设定中的“配置可更改”位置位的情况下才会成功执行。</p><p>另外还需要在之前有一次成功的主密钥验证（如果 AID=0x00，则为 PICC 主密钥，否则为应用主密钥）。</p><p>该命令带出一个字节的参数，它编码新的主密钥设定。</p><p>为了保证 ChangeKeySettings 命令由执行之前验证命令的同一个 PCD 发送，因此应用的安全机制必须与 ChangeKey 命令所使用的安全机制相同，见 4.3.4。</p><p>对参数字节进行 CRC 计算并附在参数字节之后。由于修改的数据流现在的长度为 3 个字节因此在后面加上 5 个值为 0x00 的字节，这样得到 8 字节长度的数据流，正好适合 DES/3DES 的译码操作。</p><h4 id=433-getkeysettings>4.3.3 GetKeySettings<a hidden class=anchor aria-hidden=true href=#433-getkeysettings>#</a></h4><p>GetKeySettings 命令可获取 PICC 和应用主密钥设定的信息。此外，它还返回所选应用中可保存的最大密钥数。</p><p>该命令不传递参数。</p><p>根据主密钥的设定（见 4.3.2），需要在该命令执行之前通过主密钥的验证。</p><p>如果查询 PICC 主密钥的设定（当前选择的 AID=0x00），密钥数返回 0x01，因为 PICC 上只存在一个 PICC 主密钥。</p><h4 id=434-changekey>4.3.4 ChangeKey<a hidden class=anchor aria-hidden=true href=#434-changekey>#</a></h4><p>该命令允许更改 PICC 上保存的任何密钥。</p><p>如果选择 AID=0x00，则更改 PICC 主密钥，只有 KeyNo＝0x00 有效（PICC 上只存在一个 PICC 主密钥）。在所有其它情况下（AID≠0x00），更改应用于当前所选应用中的指定 KeyNo。</p><h4 id=435-getkeyversion>4.3.5 GetKeyVersion<a hidden class=anchor aria-hidden=true href=#435-getkeyversion>#</a></h4><p>GetKeyVersion 命令允许读出任何保存在 PICC 上的密钥的当前版本。</p><p>如果选择 AID=0x0，该命令返回 PICC 主密钥的版本，并且只有 KeyNo=0x00 有效（PICC 上只存在一个 PICC 主密钥）。其它任何情况下（AID≠0x0），返回当前所选应用中指定的密钥的版本。</p><h3 id=44-mf3-ic-d40-命令集picc-级命令>4.4 MF3 IC D40 命令集—PICC 级命令：<a hidden class=anchor aria-hidden=true href=#44-mf3-ic-d40-命令集picc-级命令>#</a></h3><h4 id=441-createapplication>4.4.1 CreateApplication<a hidden class=anchor aria-hidden=true href=#441-createapplication>#</a></h4><p>CreateApplication 命令允许在 PICC 上建立新的应用。</p><h4 id=442-deleteapplication>4.4.2 DeleteApplication<a hidden class=anchor aria-hidden=true href=#442-deleteapplication>#</a></h4><p>DeleteApplication 命令允许使 PICC 上的应用永久失效。</p><h4 id=443-getapplicationids>4.4.3 GetApplicationIDs<a hidden class=anchor aria-hidden=true href=#443-getapplicationids>#</a></h4><p>GetApplicationIDs 命令返回 PICC 上所有有效应用的 AID。</p><h4 id=444-selectapplication>4.4.4 SelectApplication<a hidden class=anchor aria-hidden=true href=#444-selectapplication>#</a></h4><p>SelectApplication 命令用于选择一个指定的应用作进一步的访问。在正常操作中，这通常是一个随后的验证命令。</p><h4 id=445-formatpicc>4.4.5 FormatPICC<a hidden class=anchor aria-hidden=true href=#445-formatpicc>#</a></h4><p>该命令释放 PICC 用户存储器。</p><h4 id=446-getversion>4.4.6 GetVersion<a hidden class=anchor aria-hidden=true href=#446-getversion>#</a></h4><p>GetVersion 命令返回 PICC 与制造有关的数据。</p><h3 id=45-mf3-ic-d40-命令集应用级命令>4.5 MF3 IC D40 命令集—应用级命令：<a hidden class=anchor aria-hidden=true href=#45-mf3-ic-d40-命令集应用级命令>#</a></h3><h4 id=451-getfileids>4.5.1 GetFileIDs<a hidden class=anchor aria-hidden=true href=#451-getfileids>#</a></h4><p>GetFileIDs 命令返回当前所选应用中所有有效文件的文件标识符。</p><h4 id=452-getfilesettings>4.5.2 GetFileSettings<a hidden class=anchor aria-hidden=true href=#452-getfilesettings>#</a></h4><p>GetFileSettings 命令可以从指定文件属性获得信息。该命令获取的信息取决于被查询文件的类型。</p><h4 id=453-changefilesettings>4.5.3 ChangeFileSettings<a hidden class=anchor aria-hidden=true href=#453-changefilesettings>#</a></h4><p>该命令改变一个现有文件的访问参数。</p><h4 id=454-createstddatafile>4.5.4 CreateStdDataFile<a hidden class=anchor aria-hidden=true href=#454-createstddatafile>#</a></h4><p>CreateStdDataFile 命令在 PICC 现有的一个应用中创建用于保存无格式用户数据的文件。</p><h4 id=455-createbackupdatafile>4.5.5 CreateBackupDataFile<a hidden class=anchor aria-hidden=true href=#455-createbackupdatafile>#</a></h4><p>CreateBackupDataFile 命令在 PICC 现有的一个应用中创建用于保存无格式用户数据的文件，另外还支持集成的备份机制特性。</p><h4 id=456-createvaluefile>4.5.6 CreateValueFile<a hidden class=anchor aria-hidden=true href=#456-createvaluefile>#</a></h4><p>CreateValueFile 命令在 PICC 的一个现有文件中创建文件，该文件用于保存和处理 32 位有符号整数值。</p><h4 id=457-createlinearrecordfile>4.5.7 CreateLinearRecordFile<a hidden class=anchor aria-hidden=true href=#457-createlinearrecordfile>#</a></h4><p>CreateLinearRecordFile 命令在 PICC 的一个现有文件中创建文件，该文件用于结构相似的数据（例如 loyalty 程序）的多次存储。一旦该文件被数据记录填满，那么将无法再对该文件执行写操作，除非该文件被清空，见命令 ClearRecordFile 一节 4.6.9。</p><h4 id=458-createcyclicrecordfile>4.5.8 CreateCyclicRecordFile<a hidden class=anchor aria-hidden=true href=#458-createcyclicrecordfile>#</a></h4><p>CreateCyclicRecordFile 命令在 PICC 的一个现有文件中创建文件，该文件用于结构相似的数据（例如 loyalty 程序）的多次存储。一旦该文件被数据记录填满，PICC 自动将最新写入的记录覆盖最早的记录。该循环操作对 PCD 是完全透明的。</p><h4 id=459-deletefile>4.5.9 DeleteFile<a hidden class=anchor aria-hidden=true href=#459-deletefile>#</a></h4><p>DeleteFile 命令使当前所选应用的文件目录中的一个文件永远失效。</p><h3 id=46-mf3-ic-d40-命令集数据处理命令>4.6 MF3 IC D40 命令集—数据处理命令<a hidden class=anchor aria-hidden=true href=#46-mf3-ic-d40-命令集数据处理命令>#</a></h3><h4 id=461-readdata>4.6.1 ReadData<a hidden class=anchor aria-hidden=true href=#461-readdata>#</a></h4><p>ReadData 命令可从标准数据文件或备份数据文件中读出数据。</p><h4 id=462-writedata>4.6.2 WriteData<a hidden class=anchor aria-hidden=true href=#462-writedata>#</a></h4><p>WriteData 命令可以将数据写入标准数据文件或备份数据文件。</p><h4 id=463-getvalue>4.6.3 GetValue<a hidden class=anchor aria-hidden=true href=#463-getvalue>#</a></h4><p>GetValue 命令可以从文件中读出当前保存的值。</p><h4 id=464-credit>4.6.4 Credit<a hidden class=anchor aria-hidden=true href=#464-credit>#</a></h4><p>Credit 命令用于增加值文件中保存的值。</p><h4 id=465-debit>4.6.5 Debit<a hidden class=anchor aria-hidden=true href=#465-debit>#</a></h4><p>Dedit 命令用于减少值文件中保存的值。</p><h4 id=466-limitedcredit>4.6.6 LimitedCredit<a hidden class=anchor aria-hidden=true href=#466-limitedcredit>#</a></h4><p>LimitedCredit 命令在对文件没有完全的读&写访问权限的情况下，可以使值文件中保存的值实现有限的增加。这一特性可以在文件创建时使能或禁止。</p><h4 id=467-writerecord>4.6.7 WriteRecord<a hidden class=anchor aria-hidden=true href=#467-writerecord>#</a></h4><p>WriteRecord 命令用于将数据写入一个循环或线性的记录文件。</p><h4 id=468-readrecords>4.6.8 ReadRecords<a hidden class=anchor aria-hidden=true href=#468-readrecords>#</a></h4><p>ReadRecords 可从一个循环或线性记录文件中读出一套完整的记录。</p><h4 id=469-clearrecordfile>4.6.9 ClearRecordFile<a hidden class=anchor aria-hidden=true href=#469-clearrecordfile>#</a></h4><p>ClearRecordFile 命令将一个循环或线性记录文件复位为清空的状态。</p><h4 id=4610-committransaction>4.6.10 CommitTransaction<a hidden class=anchor aria-hidden=true href=#4610-committransaction>#</a></h4><p>CommitTransaction 命令使应用中备份数据文件、值文件和记录文件的写操作生效。</p><h4 id=4611-aborttransaction>4.6.11 AbortTransaction<a hidden class=anchor aria-hidden=true href=#4611-aborttransaction>#</a></h4><p>AbortTransaction 命令使对应用中备份数据文件、值文件和记录文件的写操作无效。
<script src=/js/pdf-js/build/pdf.js></script><style>#embed-pdf-container{position:relative;width:100%;height:auto;min-height:20vh}.pdf-canvas{border:1px solid #000;direction:ltr;width:100%;height:auto;display:none}#the-canvas{border:1px solid #000;direction:ltr;width:100%;height:auto;display:none}.pdf-loadingWrapper{display:none;justify-content:center;align-items:center;width:100%;height:350px}.pdf-loading{display:inline-block;width:50px;height:50px;border:3px solid #d2d0d0;border-radius:50%;border-top-color:#383838;animation:spin 1s ease-in-out infinite;-webkit-animation:spin 1s ease-in-out infinite}#overlayText{word-wrap:break-word;display:grid;justify-content:end}#overlayText a{position:relative;top:10px;right:4px;color:#000;margin:auto;background-color:#eee;padding:.3em 1em;border:solid 2px;border-radius:12px;border-color:#00000030;text-decoration:none}#overlayText svg{height:clamp(1em,2vw,1.4em);width:clamp(1em,2vw,1.4em)}@keyframes spin{to{-webkit-transform:rotate(360deg)}}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}</style><div class=embed-pdf-container id=embed-pdf-container-67a36937><div class=pdf-loadingWrapper id=pdf-loadingWrapper-67a36937><div class=pdf-loading id=pdf-loading-67a36937></div></div><div id=overlayText><a href=../desfire%20MF3%20IC%20D40%20%e4%b8%ad%e6%96%87%e6%89%8b%e5%86%8c.pdf aria-label=Download download><svg aria-hidden="true" viewBox="0 0 18 18"><path d="M9 13c.3.0.5-.1.7-.3L15.4 7 14 5.6l-4 4V1H8v8.6l-4-4L2.6 7l5.7 5.7c.2.2.4.3.7.3zm-7 2h14v2H2z"/></svg></a></div><canvas class=pdf-canvas id=pdf-canvas-67a36937></canvas></div><div class=pdf-paginator id=pdf-paginator-67a36937><button id=pdf-prev-67a36937>Previous</button>
<button id=pdf-next-67a36937>Next</button> &nbsp; &nbsp;
<span><span class=pdf-pagenum id=pdf-pagenum-67a36937></span> / <span class=pdf-pagecount id=pdf-pagecount-67a36937></span>
</span><a class=pdf-source id=pdf-source-67a36937 href=../desfire%20MF3%20IC%20D40%20%e4%b8%ad%e6%96%87%e6%89%8b%e5%86%8c.pdf>[pdf]</a></div><noscript>View the PDF file <a class=pdf-source id=pdf-source-noscript-67a36937 href=../desfire%20MF3%20IC%20D40%20%e4%b8%ad%e6%96%87%e6%89%8b%e5%86%8c.pdf>here</a>.</noscript><script type=text/javascript>(function(){c="../desfire MF3 IC D40 中文手册.pdf",u=""==="true",l=""==="true",h=parseInt("")||1,s=window["pdfjs-dist/build/pdf"],s.GlobalWorkerOptions.workerSrc==""&&(s.GlobalWorkerOptions.workerSrc="http://cnnu.github.io/blog/js/pdf-js/build/pdf.worker.js");var s,c,l,u,h,n=null,e=h,i=!1,o=null,b=3,t=document.getElementById("pdf-canvas-67a36937"),m=t.getContext("2d"),f=document.getElementById("pdf-paginator-67a36937"),r=document.getElementById("pdf-loadingWrapper-67a36937");v(),g();function a(e){i=!0,n.getPage(e).then(function(e){var s,r,n=e.getViewport({scale:b});t.height=n.height,t.width=n.width,s={canvasContext:m,viewport:n},r=e.render(s),r.promise.then(function(){i=!1,p(),o!==null&&(a(o),o=null)})}),document.getElementById("pdf-pagenum-67a36937").textContent=e}function p(){r.style.display="none",t.style.display="block"}function g(){if(l)return;r.style.display="flex",t.style.display="none"}function v(){if(u)return;f.style.display="block"}function d(e){i?o=e:a(e)}function j(){if(e<=1)return;e--,d(e)}document.getElementById("pdf-prev-67a36937").addEventListener("click",j);function y(){if(e>=n.numPages)return;e++,d(e)}document.getElementById("pdf-next-67a36937").addEventListener("click",y),s.getDocument(c).promise.then(function(t){n=t;var s=n.numPages;document.getElementById("pdf-pagecount-67a36937").textContent=s,e>s&&(e=s),a(e)})})()</script></p></div><footer class=post-footer><ul class=post-tags><li><a href=http://cnnu.github.io/blog/tags/%E6%A0%87%E7%AD%BE/>标签</a></li></ul><nav class=paginav><a class=next href=http://cnnu.github.io/blog/posts/sm1encrypteddataexample/><span class=title>Next »</span><br><span>SM1 加解密数据示例</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share MF3 IC D40 中文手册 on x" href="https://x.com/intent/tweet/?text=MF3%20IC%20D40%20%e4%b8%ad%e6%96%87%e6%89%8b%e5%86%8c&amp;url=http%3a%2f%2fcnnu.github.io%2fblog%2fposts%2fdesfarecaredinfo%2f&amp;hashtags=%e6%a0%87%e7%ad%be"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MF3 IC D40 中文手册 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fcnnu.github.io%2fblog%2fposts%2fdesfarecaredinfo%2f&amp;title=MF3%20IC%20D40%20%e4%b8%ad%e6%96%87%e6%89%8b%e5%86%8c&amp;summary=MF3%20IC%20D40%20%e4%b8%ad%e6%96%87%e6%89%8b%e5%86%8c&amp;source=http%3a%2f%2fcnnu.github.io%2fblog%2fposts%2fdesfarecaredinfo%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MF3 IC D40 中文手册 on reddit" href="https://reddit.com/submit?url=http%3a%2f%2fcnnu.github.io%2fblog%2fposts%2fdesfarecaredinfo%2f&title=MF3%20IC%20D40%20%e4%b8%ad%e6%96%87%e6%89%8b%e5%86%8c"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MF3 IC D40 中文手册 on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2fcnnu.github.io%2fblog%2fposts%2fdesfarecaredinfo%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MF3 IC D40 中文手册 on whatsapp" href="https://api.whatsapp.com/send?text=MF3%20IC%20D40%20%e4%b8%ad%e6%96%87%e6%89%8b%e5%86%8c%20-%20http%3a%2f%2fcnnu.github.io%2fblog%2fposts%2fdesfarecaredinfo%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MF3 IC D40 中文手册 on telegram" href="https://telegram.me/share/url?text=MF3%20IC%20D40%20%e4%b8%ad%e6%96%87%e6%89%8b%e5%86%8c&amp;url=http%3a%2f%2fcnnu.github.io%2fblog%2fposts%2fdesfarecaredinfo%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MF3 IC D40 中文手册 on ycombinator" href="https://news.ycombinator.com/submitlink?t=MF3%20IC%20D40%20%e4%b8%ad%e6%96%87%e6%89%8b%e5%86%8c&u=http%3a%2f%2fcnnu.github.io%2fblog%2fposts%2fdesfarecaredinfo%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://cnnu.github.io/blog/>CHALNONE</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>